{% extends 'base.html' %}

{% block title %}Manage SPP {% endblock %}
{% load custom_filters %}
{% block navcontent %}
            {% if request.user.is_authenticated %}
  {% if request.user.is_superuser %}
    {% include 'dashboard/admin.html' %}
  {% elif request.user.department %}
    {% if request.user.department.department_name|strip_lower == "finance" %}
      {% include 'dashboard/finance.html' %}
    {% endif %}
  {% endif %}
{% endif %}
{% endblock %}

{% block content %}

    <h1 class="text-2xl font-bold mb-4">Manage Spare Parts</h1>

    <div class="mb-4">
        <button onclick="openPopup()" class="bg-blue-600 text-white px-4 py-2 rounded-xl shadow hover:bg-blue-700">+ Add Transaction</button>
    </div>

    <table class="table-auto w-full bg-white rounded-xl overflow-hidden shadow">
        <thead class="bg-gray-200">
            <tr>
                <th class="p-2">Name</th>
                <th class="p-2">Category</th>
                <th class="p-2">Quantity</th>
                <th class="p-2">Purchase Price</th>
                <th class="p-2">Selling Price</th>
            </tr>
        </thead>
        <tbody>
            {% for part in spareparts %}
            <tr class="border-t">
                <td class="p-2">{{ part.name|title }}</td>
                <td class="p-2">{{ part.category|title }}</td>
                <td class="p-2">{{ part.quantity }}</td>
                <td class="p-2">₹ {{ part.purchase_price }}</td>
                <td class="p-2">₹ {{ part.selling_price }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pop-up Modal -->
    <div id="popupForm" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow w-full max-w-md">
            <h2 class="text-xl font-bold mb-4">Add Transaction</h2>
            <div id="formContainer"></div>
        </div>
    </div>


    <script>
        function openPopup(){
            $.get("{% url 'add_transaction' %}", function(data){
                $("#formContainer").html(data);
                $("#popupForm").removeClass("hidden").addClass("flex");
            });
        }

        function closePopup(){
            $("#popupForm").addClass("hidden");
        }
    </script>
{% endblock %}
