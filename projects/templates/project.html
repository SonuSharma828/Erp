{% extends 'base.html' %}

{% block title %}Projects {% endblock %}
{% block navcontent %}
        {% if request.user.is_authenticated %}
  {% if request.user.is_superuser %}
    {% include 'dashboard/admin.html' %}
  {% elif request.user.department %}
    {% if request.user.department.department_name|lower == "hr" %}
      {% include 'dashboard/hr.html' %}
    {% endif %}
  {% endif %}
{% endif %}
{% endblock %}

{% block content %}


    <!-- Header -->
    <div class=" flex justify-between items-center">
     <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-200">Projects</h2>
  </div>

    <!-- Main Content -->
    <div class="container mx-auto p-6">
        <!-- Page Title -->
      

        <!-- Search and Filter -->
        <div class="flex justify-between items-center mb-6">
            <div class="flex space-x-4">
                <input type="text" id="searchInput" placeholder="Search Projects..." class="px-4 py-2 border rounded-md w-64" onkeyup="filterProjects()">
                <select id="statusFilter" class="px-4 py-2 border rounded-md" onchange="filterProjects()">
                    <option value="">Status</option>
                        {% for status in statuses %}
                         <option value="{{ status.name|lower }}">{{ status.name }}</option>
                        {% endfor %}
                </select>

               <select id="clientFilter" class="px-4 py-2 border rounded-md" onchange="filterProjects()">
                       <option value="">Client</option>
                          {% for client1 in clients1 %}
                       <option value="{{ client1.customer_name|lower }}">{{ client1.customer_name }}</option>
                          {% endfor %}
               </select>
            </div>
            <a href="{% url 'project:add_project' %}" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">Add Project</a>
        </div>

        <!-- Projects Table -->
        <div class="overflow-x-auto bg-white rounded-md shadow-md">
            <table class="w-full table-auto" id="projectsTable">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="px-4 py-2 text-left">Sno</th>
                        <th class="px-4 py-2 text-left">Project Name</th>
                        <th class="px-4 py-2 text-left">Client</th>
                        <th class="px-4 py-2 text-left">Status</th>
                        <th class="px-4 py-2 text-left">Deadline</th>
                        <th class="px-4 py-2 text-left">Budget</th>
                        <th class="px-4 py-2 text-left">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for project in page_obj %}
                    <tr class="border-b hover:bg-gray-100">
                         <td class="px-4 py-2">{{ forloop.counter }}</td>
                        <td class="px-4 py-2">{{ project.name|title }}</td>
                        <td class="px-4 py-2">{{ project.client|title }}</td>
                        <td class="{% if project.status == 'completed' %}text-green-600{% elif project.status == 'active' %}text-yellow-600{% else %}text-red-600{% endif %}">{{ project.status|title }}</td>
                        <td class="px-4 py-2">{{ project.deadline }}</td>
                        <td class="px-4 py-2 ">{{ project.total_budget }}</td>
                        <td class="px-4 py-2">
                         
                            
                            <a href="{% url 'project:edit_project' project.pk %}" class="inline-block bg-blue-500 text-white text-sm px-3 py-1 rounded hover:bg-blue-600">Edit</a>
                            
                            <a href="{% url 'project:delete_project' project.pk %}" class="inline-block bg-red-500 text-white text-sm px-3 py-1 rounded hover:bg-red-600" onclick="confirm('Are you sure you want to Delete ??')">Delete</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
{% if page_obj.paginator.count > 10 %}
<div class="mt-4 flex justify-center space-x-2">
  {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">&laquo; Prev</a>
  {% endif %}

  <span class="px-4 py-1 bg-blue-600 text-white rounded">{{ page_obj.number }}</span>

  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Next &raquo;</a>
  {% endif %}
</div>
{% endif %}

    </div>

<script>
    function filterProjects() {
        const searchInput = document.getElementById('searchInput').value.toLowerCase();
        const statusFilter = document.getElementById('statusFilter').value.toLowerCase();
        const clientFilter = document.getElementById('clientFilter').value.toLowerCase();

        const rows = document.querySelectorAll('#projectsTable tbody tr');

        rows.forEach(row => {
            // Adjusted column indexes due to 'Sno' being the first column
            const projectName = row.querySelector('td:nth-child(2)')?.textContent.toLowerCase() || '';
            const clientName = row.querySelector('td:nth-child(3)')?.textContent.toLowerCase() || '';
            const projectStatus = row.querySelector('td:nth-child(4)')?.textContent.toLowerCase() || '';

            const matchesSearch = projectName.includes(searchInput) || clientName.includes(searchInput);
            const matchesStatus = !statusFilter || projectStatus === statusFilter;
            const matchesClient = !clientFilter || clientName === clientFilter;

            const shouldShow = matchesSearch && matchesStatus && matchesClient;
            row.style.display = shouldShow ? '' : 'none';
        });
    }
</script>


{% endblock %}
