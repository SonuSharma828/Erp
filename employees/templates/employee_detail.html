{% extends 'base.html' %}
{% block title %}Employees {% endblock %}
{% load static %}
{% block navcontent %}
        {% if request.user.is_authenticated %}
  {% if request.user.is_superuser %}
    {% include 'dashboard/admin.html' %}
  {% elif request.user.department %}
    {% if request.user.department.department_name|lower == "hr" %}
      {% include 'dashboard/hr.html' %}
    {% endif %}
  {% endif %}
{% endif %}
{% endblock %}
{% block content %}
<div class="p-4">
    <h2 class="text-2xl font-semibold mb-4">{{ employee.name }}</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-white p-4 rounded shadow">
            <h3 class="text-lg font-semibold mb-2">Personal Details</h3>
            <p><strong>Email:</strong> {{ employee.email }}</p>
            <p><strong>Phone:</strong> {{ employee.phone }}</p>
            <p><strong>Position:</strong> {{ employee.position }}</p>
            <p><strong>Joining Date:</strong> {{ employee.joining_date }}</p>
            <p><strong>Salary:</strong> ₹{{ employee.salary }}</p>
            <p><strong>Final Salary after Deductions:</strong> ₹{{ final_salary }}</p>
        </div>

        <div class="bg-white p-4 rounded shadow">
            <h3 class="text-lg font-semibold mb-2">Photo ID</h3>
            {% if employee.photo_id_file %}
                <p><strong>Type:</strong> {{ employee.get_photo_id_type_display }}</p>
                <a href="{{ employee.photo_id_file.url }}" class="text-blue-500 underline" target="_blank">
                   View Document</a>
            {% else %}
                <p>No ID uploaded.</p>
            {% endif %}
        </div>
    </div>

    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-white p-4 rounded shadow">
            <h3 class="text-lg font-semibold mb-2">Expense History (₹{{ total_expenses }})</h3>
            <ul class="list-disc ml-4">
                {% for exp in expenses %}
                <li>{{ exp.date }} — ₹{{ exp.amount }} ({{ exp.description }})</li>
                {% empty %}
                <li>No expenses</li>
                {% endfor %}
            </ul>
        </div>

        <div class="bg-white p-4 rounded shadow">
            <h3 class="text-lg font-semibold mb-2">Salary Deductions (₹{{ total_deductions }})</h3>
            <ul class="list-disc ml-4">
                {% for d in deductions %}
                <li>{{ d.date }} — ₹{{ d.amount }} ({{ d.description }})</li>
                {% empty %}
                <li>No deductions</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="mt-6 bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold mb-2">Tasks</h3>
        <p><strong>Completed:</strong> {{ tasks_completed|length }}</p>
        <p><strong>Pending:</strong> {{ tasks_pending|length }}</p>
        <ul class="list-disc ml-4 mt-2">
            {% for task in tasks_pending %}
            <li class="text-red-600">[Pending] {{ task.title }}</li>
            {% endfor %}
            {% for task in tasks_completed %}
            <li class="text-green-600">[Done] {{ task.title }}</li>
            {% endfor %}
        </ul>
    </div>


<div class="mt-6 bg-white p-4 rounded shadow">
    <h3 class="text-lg font-semibold mb-2">Bills Submitted by {{ employee.name }}</h3>

    {% if bills %}
    <div class="overflow-x-auto">
        <table class="min-w-full text-sm text-left text-gray-700">
            <thead class="bg-gray-100 text-xs uppercase">
                <tr>
                    <th class="px-4 py-2">Task</th>
                    <th class="px-4 py-2">Tools Total (₹)</th>
                    <th class="px-4 py-2">Service Total (₹)</th>
                    <th class="px-4 py-2">Final Total (₹)</th>
                    <th class="px-4 py-2">Submitted At</th>
                </tr>
            </thead>
            <tbody class="divide-y">
                {% for bill in bills %}
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-2">#{{ bill.task.sno }} - {{ bill.task.title }}</td>
                    <td class="px-4 py-2">₹{{ bill.tools_total }}</td>
                    <td class="px-4 py-2">₹{{ bill.service_total }}</td>
                    <td class="px-4 py-2 font-semibold text-green-700">₹{{ bill.final_total }}</td>
                    <td class="px-4 py-2 text-sm text-gray-500">{{ bill.submitted_at|date:"Y-m-d H:i" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="text-gray-500">No bills submitted yet by this employee.</p>
    {% endif %}
</div>

</div>
{% endblock %}

